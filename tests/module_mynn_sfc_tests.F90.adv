! Module for MYNN SFC scheme tests
module module_ccpp_mynn_sfc_tests
  implicit none
  contains
    !=================================================================================================================    

    subroutine init_mynn_sfc_flags_for_test_all_true()
      
      l_mp_tables = .true.
      aerosol_aware_flag = .true.
      hail_aware_flag = .true.
      
    end subroutine init_mynn_sfc_flags_for_test_all_true
    !=================================================================================================================    
    subroutine init_ccpp_data_for_test(nlev)
      integer, intent(in) :: nlev
      real  
      ! opening data file

    end subroutine init_ccpp_data_for_test
    !=================================================================================================================
    subroutine ccpp_test()
      use module_sf_mynnsfc_driver


      ! Initialize input data for tests
      call init_ccpp_data_for_test(nlev=59)

      
      ! Initialize MYNN SFC flags for tests
      call init_mynn_sfc_flags_for_test_all_true()

      ! Initialize MYNN SFC
      write(*,*) '--- calling  module_sf_mynnsfc_driver_init()'
      call  module_sf_mynnsfc_driver_init(do_mynnsfclay, &
       &                             errmsg, errflg)

      ! Time integration
      do t = 1, integration_length_sec
         itimestep = t

         if (t == 1) then
            write(*,*) '--- calling module_sf_mynnsfc_driver_run()'
         endif

         if (t == integration_length_sec) then
            write(*,*) 'Final timestep for MYNN SFC: ', t
         endif

         call module_sf_mynnsfc_driver_run(   &
         &  im=im,levs=levs,                           &
         &  itimestep=itimestep,iter,flag_iter,          &
         &  flag_init,flag_restart,lsm,lsm_ruc,&
         &  sigmaf,vegtype,shdmax,ivegsrc,     &  !intent(in)
         &  z0pert,ztpert,                     &  !intent(in)
         &  redrag,sfc_z0_type,                &  !intent(in)
         &  isftcflx,iz0tlnd,                  &  !intent(in)
         &  sfclay_compute_flux,               &  !intent(in)
         &  sfclay_compute_diag,               &  !intent(in)
         &  delt,dx,                           &
         &  u, v, t3d, qvsh, qc, prsl, phii,   &
         &  exner, ps, PBLH, slmsk,            &
         &         wet,       dry,       icy,  &  !intent(in)
         &   tskin_wat, tskin_lnd, tskin_ice,  &  !intent(in)
         &   tsurf_wat, tsurf_lnd, tsurf_ice,  &  !intent(in)
         &    qsfc_wat,  qsfc_lnd,  qsfc_ice,  &  !intent(in)
         &              snowh_lnd, snowh_ice,  &  !intent(in)
         &     znt_wat,   znt_lnd,   znt_ice,  &  !intent(inout)
         &     ust_wat,   ust_lnd,   ust_ice,  &  !intent(inout)
         &      cm_wat,    cm_lnd,    cm_ice,  &  !intent(inout)
         &      ch_wat,    ch_lnd,    ch_ice,  &  !intent(inout)
         &      rb_wat,    rb_lnd,    rb_ice,  &  !intent(inout)
         &  stress_wat,stress_lnd,stress_ice,  &  !intent(inout)
         &      fm_wat,    fm_lnd,    fm_ice,  &  !intent(inout)
         &      fh_wat,    fh_lnd,    fh_ice,  &  !intent(inout)
         &    fm10_wat,  fm10_lnd,  fm10_ice,  &  !intent(inout)
         &     fh2_wat,   fh2_lnd,   fh2_ice,  &  !intent(inout)
         &    hflx_wat,  hflx_lnd,  hflx_ice,  &
         &    qflx_wat,  qflx_lnd,  qflx_ice,  &
         &  QSFC, qsfc_lnd_ruc, qsfc_ice_ruc,  &
         &  USTM, ZOL, MOL,                    &
         &  RMOL, WSPD, ch, HFLX, QFLX, LH,    &
         &  FLHC, FLQC,                        &
         &  U10, V10, TH2, T2, Q2,             &
         &  wstar, CHS2, CQS2,                 &
         &  spp_wts_sfc, spp_sfc,              &
         &  lprnt, errmsg, errflg              )
      enddo


      ! output data to file 
      open(1, file = 'ccpp_mynnsfc_test_results.txt')
      write(1,*) 'klev qv dz'
      do j = jts, jte
         do i = its, ite
            ! k-loop
            do k = kts, kte
               write(1,*) k, qv(i,k,j), dz(i,k,j)
            enddo
         enddo
      enddo
      
      close(1)
    end subroutine ccpp_test
    !=================================================================================================================
    
end module module_ccpp_mynn_sfc_tests           
